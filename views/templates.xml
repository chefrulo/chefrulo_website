<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <!-- Add "Request Quote" button on the cart page -->
    <template id="cart_request_quote_button"
              inherit_id="website_sale.navigation_buttons"
              name="Request Quote Button">
        <xpath expr="//a[@name='website_sale_main_button']" position="after">
            <t t-if="xmlid == 'website_sale.cart' and website.enable_request_quote">
                <a role="button"
                   t-attf-class="btn btn-secondary w-100 mt-2 #{not website_sale_order._is_cart_ready() and 'disabled'}"
                   href="/shop/request_quotation">
                    <i class="fa fa-file-text-o me-2"/>
                    Request a Quote
                </a>
            </t>
        </xpath>
    </template>

    <!-- Add "Request Quote" button on the payment page -->
    <template id="payment_request_quote_button"
              inherit_id="website_sale.payment"
              name="Request Quote on Payment Page">
        <xpath expr="//t[@name='website_sale_non_free_cart']" position="before">
            <div t-if="website.enable_request_quote" class="card mb-3">
                <div class="card-body text-center">
                    <p class="mb-2 fw-bold">Don't want to pay now?</p>
                    <a role="button"
                       class="btn btn-secondary"
                       href="/shop/request_quotation">
                        <i class="fa fa-file-text-o me-2"/>
                        Request a Quote Instead
                    </a>
                    <p class="text-muted small mt-2 mb-0">
                        We will send you a formal quotation by email.
                    </p>
                </div>
            </div>
        </xpath>
    </template>

    <!-- Quotation confirmation page -->
    <template id="quotation_confirmation" name="Quotation Request Confirmation">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure">
                <div class="container py-5">
                    <div class="row justify-content-center">
                        <div class="col-lg-8 text-center">
                            <div class="mb-4">
                                <i class="fa fa-check-circle text-success" style="font-size: 64px;"/>
                            </div>
                            <h1 class="mb-3">Quote Request Received!</h1>
                            <p class="lead text-muted mb-4">
                                Thank you for your interest. We have received your quote request
                                <strong t-out="order.name"/> and will get back to you shortly.
                            </p>
                            <div class="card mb-4">
                                <div class="card-body">
                                    <h5 class="card-title mb-3">Order Summary</h5>
                                    <table class="table table-sm mb-0">
                                        <thead>
                                            <tr>
                                                <th class="text-start">Product</th>
                                                <th class="text-center">Qty</th>
                                                <th class="text-end">Price</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <t t-foreach="order.order_line" t-as="line">
                                                <tr t-if="not line.display_type">
                                                    <td class="text-start" t-out="line.product_id.name"/>
                                                    <td class="text-center" t-out="int(line.product_uom_qty)"/>
                                                    <td class="text-end" t-out="line.price_subtotal"
                                                        t-options="{'widget': 'monetary', 'display_currency': order.currency_id}"/>
                                                </tr>
                                            </t>
                                        </tbody>
                                        <tfoot>
                                            <tr class="fw-bold">
                                                <td colspan="2" class="text-end">Total:</td>
                                                <td class="text-end" t-out="order.amount_total"
                                                    t-options="{'widget': 'monetary', 'display_currency': order.currency_id}"/>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                            <p class="text-muted">
                                We will review your request and send you a formal quotation by email.
                            </p>
                            <a href="/shop" class="btn btn-primary mt-3">
                                <i class="fa fa-arrow-left me-2"/>
                                Continue Shopping
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Menu / Catalog page -->
    <template id="menu_page" name="Menu Catalog Page">
        <t t-call="website.layout">
            <div id="wrap">
                <!-- Editable zone: above header (hero, banners, etc.) -->
                <div id="menu_top" class="oe_structure"/>

                <!-- Header -->
                <div class="container py-5 text-center">
                    <h1 class="display-4 fw-bold">Our Menu</h1>
                    <p class="lead text-muted">Browse our selection and add items to your cart</p>
                </div>

                <!-- Editable zone: between header and products -->
                <div id="menu_before_products" class="oe_structure"/>

                <div class="container pb-5">
                    <t t-foreach="menu_data" t-as="section">
                        <!-- Category Header -->
                        <div class="mb-5">
                            <div class="border-bottom pb-2 mb-4">
                                <h2 class="fw-bold" t-out="section['category'].name"/>
                            </div>

                            <t t-foreach="section['subcategories']" t-as="sub">
                                <!-- Subcategory Header -->
                                <t t-if="sub['category'].id != section['category'].id">
                                    <h4 class="text-muted mt-4 mb-3" t-out="sub['category'].name"/>
                                </t>

                                <!-- Product List -->
                                <t t-foreach="sub['products']" t-as="product">
                                    <div class="row align-items-center py-3 border-bottom">
                                        <!-- Product Image -->
                                        <div class="col-auto">
                                            <a t-attf-href="/shop/#{product.id}">
                                                <img t-att-src="website.image_url(product, 'image_128')"
                                                     t-att-alt="product.name"
                                                     class="rounded"
                                                     style="width: 80px; height: 80px; object-fit: cover;"/>
                                            </a>
                                        </div>
                                        <!-- Product Info -->
                                        <div class="col">
                                            <a t-attf-href="/shop/#{product.id}" class="text-decoration-none text-reset">
                                                <h5 class="mb-1" t-out="product.name"/>
                                            </a>
                                            <p t-if="product.description_sale"
                                               class="text-muted small mb-0"
                                               t-out="product.description_sale"/>
                                        </div>
                                        <!-- Price -->
                                        <div class="col-auto text-end">
                                            <span class="fw-bold fs-5"
                                                  t-out="product.list_price"
                                                  t-options="{'widget': 'monetary', 'display_currency': website.currency_id}"/>
                                        </div>
                                        <!-- Add to Cart -->
                                        <div class="col-auto">
                                            <t t-if="product.product_variant_count == 1">
                                                <!-- No variants: show add to cart directly -->
                                                <form class="js_menu_add_to_cart d-flex align-items-center gap-2">
                                                    <input type="number"
                                                           class="form-control form-control-sm text-center"
                                                           style="width: 70px;"
                                                           name="add_qty"
                                                           value="1"
                                                           min="1"/>
                                                    <button type="button"
                                                            class="btn btn-primary btn-sm js_menu_cart_btn"
                                                            t-att-data-product-id="product.product_variant_id.id">
                                                        <i class="fa fa-cart-plus me-1"/>
                                                        Add
                                                    </button>
                                                </form>
                                            </t>
                                            <t t-else="">
                                                <!-- Has variants: link to product page -->
                                                <a t-attf-href="/shop/#{product.id}" class="btn btn-primary btn-sm">
                                                    <i class="fa fa-arrow-right me-1"/>
                                                    View Options
                                                </a>
                                            </t>
                                        </div>
                                    </div>
                                </t>
                            </t>
                        </div>
                    </t>

                    <!-- Empty state -->
                    <t t-if="not menu_data">
                        <div class="text-center py-5">
                            <i class="fa fa-cutlery text-muted" style="font-size: 64px;"/>
                            <h3 class="mt-3 text-muted">Menu coming soon</h3>
                            <p class="text-muted">We are preparing our menu. Please check back later.</p>
                        </div>
                    </t>
                </div>

                <!-- Editable zone: below products (testimonials, contact, etc.) -->
                <div id="menu_bottom" class="oe_structure"/>
            </div>
        </t>
    </template>

    <!-- Google Reviews Badge Snippet -->
    <template id="s_google_reviews" name="Google Reviews Badge">
        <section class="s_google_reviews pt32 pb32">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-auto">
                        <a href="https://www.google.com/maps/place/Chef+Rulo+Homemade+Argentinean+Empanadas/@51.4226636,-0.0024319,17z/data=!4m8!3m7!1s0x487601b3e2bc0a5d:0xd34770e1ecc339d0!8m2!3d51.4226636!4d-0.0024319!9m1!1b1!16s%2Fg%2F11vhp006zl"
                           target="_blank"
                           rel="noopener noreferrer"
                           class="text-decoration-none">
                            <div class="google-reviews-badge d-flex align-items-center gap-3 p-3 bg-white rounded-3 shadow-sm border">
                                <!-- Google Logo -->
                                <div class="google-logo">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 48 48">
                                        <path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"/>
                                        <path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"/>
                                        <path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"/>
                                        <path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z"/>
                                    </svg>
                                </div>
                                <!-- Rating Info -->
                                <div class="rating-info text-start">
                                    <div class="d-flex align-items-center gap-2 mb-1">
                                        <span class="rating-number fw-bold fs-4 text-dark">5.0</span>
                                        <div class="stars text-warning">
                                            <i class="fa fa-star"></i>
                                            <i class="fa fa-star"></i>
                                            <i class="fa fa-star"></i>
                                            <i class="fa fa-star"></i>
                                            <i class="fa fa-star"></i>
                                        </div>
                                    </div>
                                    <div class="review-count text-muted small">
                                        Based on <strong>14 reviews</strong>
                                    </div>
                                </div>
                                <!-- Arrow -->
                                <div class="arrow text-muted ms-2">
                                    <i class="fa fa-chevron-right"></i>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </section>
    </template>

    <!-- Register Google Reviews as a Website Builder Snippet -->
    <template id="google_reviews_snippet" inherit_id="website.snippets" name="Google Reviews Snippet">
        <xpath expr="//div[@id='snippet_structure']/div[@class='o_panel_body']" position="inside">
            <t t-snippet="chefrulo_website.s_google_reviews"
               t-thumbnail="/chefrulo_website/static/src/img/snippets/s_google_reviews.svg"/>
        </xpath>
    </template>

    <!-- Discount badge is handled by product_page_discount.js -->

    <!-- Remove Terms and Conditions / money-back / shipping text from product page -->
    <template id="product_custom_text_hidden"
              inherit_id="website_sale.product_custom_text"
              name="Hide Product Terms Text">
        <xpath expr="//p[hasclass('text-muted')]" position="replace">
            <!-- Empty - removed default terms text -->
        </xpath>
    </template>

    <!-- Remove social share buttons from product page -->
    <template id="product_share_buttons_hidden"
              inherit_id="website_sale.product_share_buttons"
              name="Hide Product Share Buttons">
        <xpath expr="//div[hasclass('h4')]" position="replace">
            <!-- Empty - removed share buttons -->
        </xpath>
    </template>

    <!-- Hide variant price extra badges (e.g., "+ £36.00") -->
    <template id="badge_extra_price_hidden"
              inherit_id="website_sale.badge_extra_price"
              name="Hide Extra Price Badge">
        <xpath expr="//span[hasclass('badge')]" position="replace">
            <!-- Empty - don't show extra price on variants -->
        </xpath>
    </template>

    <!-- Change "All Products" breadcrumb based on product category -->
    <template id="product_breadcrumb_dynamic"
              inherit_id="website_sale.product"
              name="Dynamic Breadcrumb by Category">
        <xpath expr="//ol[hasclass('breadcrumb')]/li[1]/a" position="replace">
            <t t-set="product_categories" t-value="product.public_categ_ids.mapped('name')"/>
            <t t-set="has_catering" t-value="'Catering' in product_categories or any('Catering' in (c.parent_id.name or '') for c in product.public_categ_ids)"/>
            <a t-if="has_catering" href="/catering">Catering</a>
            <a t-else="" href="/frozen">All Products</a>
        </xpath>
    </template>

    <!-- Move product description_sale to the end of the product page -->
    <template id="product_description_bottom"
              inherit_id="website_sale.product"
              name="Product Description at Bottom">
        <!-- Hide the original description_sale -->
        <xpath expr="//p[@t-field='product.description_sale']" position="attributes">
            <attribute name="class">d-none</attribute>
        </xpath>

        <!-- Add description_sale after Terms and Share section -->
        <xpath expr="//div[@id='o_product_terms_and_share']" position="after">
            <div t-if="product.description_sale" class="product-description-bottom mt-3 pt-3 border-top">
                <p t-field="product.description_sale" class="text-muted"/>
            </div>
        </xpath>
    </template>

    <!-- ========================================
         Steps Overlay Snippet (Pick, Get, Bake)
         ======================================== -->
    <template id="s_steps_overlay" name="Steps Overlay">
        <div class="s_steps_overlay oe_structure_solo" data-snippet="s_steps_overlay" data-name="Steps Overlay">
            <div class="steps-container">
                <div class="steps-row">
                    <!-- Step 1 -->
                    <div class="step-card">
                        <div class="step-icon">
                            <img src="/web/image/1053-ff89120b/box.webp" alt="Pick Your Box" loading="lazy"/>
                        </div>
                        <h3>1- Pick Your Box</h3>
                        <p>Choose from our ready-made boxes: Sampler, Gaucho, Veggie, or Outback. Each is packed with handmade empanadas and frozen fresh. Stock your freezer and always have real Argentinian empanadas ready whenever you crave them.</p>
                    </div>
                    <!-- Step 2 -->
                    <div class="step-card">
                        <div class="step-icon">
                            <img src="/web/image/1055-31f509ba/camioncito.webp" alt="Get Your Box" loading="lazy"/>
                        </div>
                        <h3>2- Get Your Box</h3>
                        <p>Delivered to your door for a £5 flat fee (within 4 miles), or free delivery when your order is £60 or more.</p>
                        <a href="/shop" class="step-link">Click here for more information</a>
                    </div>
                    <!-- Step 3 -->
                    <div class="step-card">
                        <div class="step-icon">
                            <img src="/web/image/1054-aa9dc17f/hornito.webp" alt="Bake and Enjoy" loading="lazy"/>
                        </div>
                        <h3>3- Bake &amp; Enjoy</h3>
                        <p>From <strong>frozen</strong>: Place the empanadas on a lined baking tray and bake for 20 minutes, until the pastry is golden and crisp.</p>
                        <a href="/cooking-instructions" class="step-link">Click here for cooking guidelines</a>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Register Steps Overlay as Inner Content Snippet -->
    <template id="steps_overlay_snippet" inherit_id="website.snippets" name="Steps Overlay Snippet">
        <xpath expr="//div[@id='snippet_content']/div[@class='o_panel_body']" position="inside">
            <t t-snippet="chefrulo_website.s_steps_overlay"
               t-thumbnail="/chefrulo_website/static/src/img/snippets/s_steps_overlay.svg"/>
        </xpath>
    </template>

    <!-- ========================================
         Image with Popup Snippet
         ======================================== -->
    <template id="s_image_popup" name="Image with Popup">
        <section class="s_image_popup pt16 pb16">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-6 text-center">
                        <img class="o_popup_image img-fluid rounded"
                             src="/web/image/website.library_image_08"
                             alt="Click to enlarge"
                             data-popup-title="Image Title"
                             style="cursor: pointer;"/>
                        <p class="mt-2 text-muted small">Click image to enlarge</p>
                    </div>
                </div>
            </div>
        </section>
    </template>

    <!-- Register Image Popup as a Website Builder Snippet -->
    <template id="image_popup_snippet" inherit_id="website.snippets" name="Image Popup Snippet">
        <xpath expr="//div[@id='snippet_structure']/div[@class='o_panel_body']" position="inside">
            <t t-snippet="chefrulo_website.s_image_popup"
               t-thumbnail="/chefrulo_website/static/src/img/snippets/s_image_popup.svg"/>
        </xpath>
    </template>

</odoo>
